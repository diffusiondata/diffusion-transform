<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia Site Renderer 1.4 at 2018-03-04 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Messaging - </title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print" />
    <meta name="Date-Revision-yyyymmdd" content="20180304" />
    <meta http-equiv="Content-Language" content="en" />
        
        </head>
  <body class="composite">
    <div id="banner">
                    <div id="bannerLeft">
                Messaging
                </div>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
                    
                <div class="xleft">
        <span id="publishDate">Last Published: 2018-03-04</span>
                  &nbsp;| <span id="projectVersion">Version: 4.0.0</span>
                      </div>
            <div class="xright">        
                    
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
                    
                                <h5>Parent Project</h5>
                  <ul>
                  <li class="none">
                          <a href="../index.html" title="Diffusion Transform Parent">Diffusion Transform Parent</a>
            </li>
          </ul>
                       <h5>Details</h5>
                  <ul>
                  <li class="none">
                          <a href="../transformers/transformers.html" title="Transformers">Transformers</a>
            </li>
                  <li class="none">
                          <a href="../transformers/json-transformers.html" title="JSON Transformers">JSON Transformers</a>
            </li>
                  <li class="none">
                          <a href="../transformers/transformer-builders.html" title="Transformer Builders">Transformer Builders</a>
            </li>
                  <li class="none">
                          <a href="../streams/stream-builders.html" title="Stream Builders">Stream Builders</a>
            </li>
                  <li class="none">
                          <a href="../updaters/updater-builders.html" title="Updater Builders">Updater Builders</a>
            </li>
                  <li class="none">
            <strong>Messaging</strong>
          </li>
          </ul>
                       <h5>Project Documentation</h5>
                  <ul>
                                                                                                                                                                                <li class="collapsed">
                          <a href="project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                    <li class="collapsed">
                          <a href="project-reports.html" title="Project Reports">Project Reports</a>
                  </li>
          </ul>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                   
                    
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <h1>Messaging</h1>
<p>Messaging is divided into several interacting features. Sending and receiving requests but also how specific the destination is.</p>
<p>Requests can be sent either to sessions or to the server. Sending to a session requires either the <tt>SessionId</tt> or the use of a session filter. The session filter can be used to send to multiple sessions. Sending to a session requires the <tt>send_to_session</tt> permission. Sending to the server requires the <tt>send_to_message_handler</tt> permission.</p>
<p>Request streams and requests handlers both receive messages. Request streams receive requests sent to sessions. Request handlers receive requests sent to the server. Request handlers need to be registered with the server to intercept the messages, this needs the <tt>register_handler</tt> permission.</p>
<p>The division by destination allows for the separation of front- and backend clients. It&#x2019;s expected that frontend clients can send to the server and receive requests sent to it. This needs the <tt>send_to_message_handler</tt> permission. Backend clients can send to sessions and register request handlers with the server. This needs the <tt>send_to_session</tt> and <tt>register_handler</tt> permissions. The difference in permissions allows the server to enforce the roles of clients.</p>
<div class="section">
<div class="section">
<h3>Transforming requests received from the server<a name="Transforming_requests_received_from_the_server"></a></h3>
<p>To transform requests received from a server a <tt>TransformedRequestStream</tt> needs to be set on a session. A <tt>RequestReceiverBuilders</tt> can be used to configure the transformation and set the stream.</p>

<div class="source">
<pre>RequestReceiverBuilders
    .requestStreamBuilder(JSON.class, String.class)
    .unsafeTransformRequest(Transformers.stringify())
    .bind(session)
    .setStream(
        &quot;json/random&quot;,
        new TransformedRequestStream&lt;JSON, String, String&gt;() {
            @Override
            public void onRequest(String path, String request, Responder&lt;String&gt; responder) {
                LOG.warn(&quot;{} request, path={}, message={}&quot;, this, path, request);
                try {
                    responder.respond(null);
                }
                catch (TransformationException e) {
                    LOG.warn(&quot;{} failed to transform response&quot;, this, e);
                }
            }

            @Override
            public void onTransformationException(
                    String path,
                    JSON request,
                    Responder&lt;String&gt; responder,
                    TransformationException e) {
                LOG.warn(&quot;{} transformation error, path={}, message={}&quot;, this, path, request, e);
            }

            @Override
            public void onClose() {
                LOG.debug(&quot;{} closed&quot;, this);
            }

            @Override
            public void onError(ErrorReason errorReason) {
                LOG.warn(&quot;Failed to send message, {}&quot;, errorReason);
            }
        });
</pre></div></div>
<div class="section">
<h3>Transforming requests received from sessions<a name="Transforming_requests_received_from_sessions"></a></h3>
<p>To transform requests received from a server a <tt>TransformedRequestHandler</tt> needs to be registered with the server. The <tt>register_handler</tt> permission is needed to be able to register the handler. A <tt>RequestReceiverBuilders</tt> can be used to configure the transformation and set the handler.</p>

<div class="source">
<pre>RequestReceiverBuilders
    .requestStreamBuilder(JSON.class, String.class)
    .unsafeTransformRequest(Transformers.stringify())
    .bind(session)
    .addRequestHandler(
        &quot;json/random&quot;,
        new TransformedRequestHandler&lt;JSON, String, String&gt;() {
            @Override
            public void onRequest(
                String request,
                RequestContext requestContext,
                Responder&lt;String&gt; responder) {

                LOG.warn(&quot;{} request, path={}, message={}&quot;, this, requestContext.getPath(), request);
                try {
                    responder.respond(null);
                }
                catch (TransformationException e) {
                    LOG.warn(&quot;{} failed to transform response&quot;, this, e);
                }
            }

            @Override
            public void onTransformationException(
                JSON request,
                RequestContext requestContext,
                Responder&lt;String&gt; responder,
                TransformationException e) {

                LOG.warn(
                    &quot;{} transformation error, path={}, message={}&quot;,
                    this,
                    requestContext.getPath(),
                    request,
                    e);
            }

            @Override
            public void onClose() {
                LOG.debug(&quot;{} closed&quot;, this);
            }

            @Override
            public void onError(ErrorReason errorReason) {
                LOG.warn(&quot;Failed to send message, {}&quot;, errorReason);
            }
        });
</pre></div></div></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                    2018
                        <a href="http://www.pushtechnology.com">Push Technology Limited</a>.
            All Rights Reserved.      
                    
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>